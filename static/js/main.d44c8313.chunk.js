(this.webpackJsonpKuba=this.webpackJsonpKuba||[]).push([[0],{82:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var r,a,c,o,u,i,s,l,b,O,j=n(0),f=n.n(j),d=n(22),p=n.n(d),h=(n(82),n(7)),v=n(118),g=n(131),m=n(120),E=n(15),x=n(4),y=n(5),T=n(45),w=function(e){return e[e.length-1]},M=function(e,t){return e+t},N=function(e){window.location.hash=null!==e&&void 0!==e?e:""},R=function(e,t){return Array.from({length:Math.ceil(e.length/t)},(function(n,r){return e.slice(r*t,r*t+t)}))},C=function(e){var t=e.toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)};!function(e){e[e.EMPTY=-1]="EMPTY",e[e.WHITE=0]="WHITE",e[e.BLACK=1]="BLACK",e[e.RED=2]="RED"}(s||(s={})),function(e){e.LEFT="l",e.RIGHT="r",e.UP="u",e.DOWN="d"}(l||(l={})),function(e){e[e.NONE=-1]="NONE",e[e.GAME_OVER=0]="GAME_OVER",e[e.WRONG_TURN=1]="WRONG_TURN",e[e.WRONG_DIRECTION=2]="WRONG_DIRECTION",e[e.OWN_MARBLE=3]="OWN_MARBLE",e[e.NO_UNDO=4]="NO_UNDO"}(b||(b={})),function(e){e[e.OFF_GRID=-1]="OFF_GRID"}(O||(O={}));var P,I=(r={},Object(y.a)(r,b.GAME_OVER,"Game is already over"),Object(y.a)(r,b.WRONG_TURN,"Opponent's turn"),Object(y.a)(r,b.WRONG_DIRECTION,"Invalid direction"),Object(y.a)(r,b.OWN_MARBLE,"Cannot push off own marble"),Object(y.a)(r,b.NO_UNDO,"Cannot undo opponent's move"),r),k=(a={},Object(y.a)(a,s.WHITE,"w"),Object(y.a)(a,s.BLACK,"b"),Object(y.a)(a,s.RED,"r"),Object(y.a)(a,s.EMPTY,""),a),D={w:s.WHITE,b:s.BLACK,r:s.RED},S=(c={},Object(y.a)(c,l.LEFT,-1),Object(y.a)(c,l.RIGHT,1),Object(y.a)(c,l.UP,-7),Object(y.a)(c,l.DOWN,7),c),W=(o={},Object(y.a)(o,l.LEFT,new Set([0,7,14,21,28,35,42])),Object(y.a)(o,l.RIGHT,new Set([6,13,20,27,34,41,48])),Object(y.a)(o,l.UP,new Set([0,1,2,3,4,5,6])),Object(y.a)(o,l.DOWN,new Set([42,43,44,45,46,47,48])),o),A=(u={},Object(y.a)(u,s.WHITE,s.BLACK),Object(y.a)(u,s.BLACK,s.WHITE),u),G=(i={},Object(y.a)(i,l.UP,l.DOWN),Object(y.a)(i,l.DOWN,l.UP),Object(y.a)(i,l.LEFT,l.RIGHT),Object(y.a)(i,l.RIGHT,l.LEFT),i),L=function(e){return A[e]},_=function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return W[r].has(n)},H=function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return M(S[r],n)},F=function(){var e=[s.EMPTY,s.BLACK,s.WHITE,s.RED],t=e[0],n=e[1],r=e[2],a=e[3];return[r,r,t,t,t,n,n,r,r,t,a,t,n,n,t,t,a,a,a,t,t,t,a,a,a,a,a,t,t,t,a,a,a,t,t,n,n,t,a,t,r,r,n,n,t,t,t,r,r]},B=function(e,t){return Object.values(e).filter((function(e){return e.color===t})).reduce((function(e,t){var n=t.moves;return e+Object.values(n).reduce((function(e,t){return t===b.NONE?e+1:e}),0)}),0)},U=function(e){return e.reduce((function(e,t){return t===s.EMPTY?e:Object(x.a)(Object(x.a)({},e),{},Object(y.a)({},t,void 0===e[t]?1:e[t]+1))}),{})},z=function(e){return e===s.EMPTY},Y=function(e){return e.reduce((function(e,t,n){return z(t)?e:[].concat(Object(E.a)(e),[{pos:n,color:t,id:n}])}),[])},K=function(e){return(t=e,R(t,7)).reduce((function(e,t){var n=0,r=t.reduce((function(e,t){if(t===s.EMPTY)return n+=1,e;if(n>0){var r=e+n.toString()+k[t];return n=0,r}return e+k[t]}),e);return n>0?r+n.toString()+"/":r+"/"}),"").slice(0,-1);var t},V=function(e){return Object.entries(e).map((function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return k[parseInt(n)]+r.toString()})).join("")},J=function(e){return new Promise((function(t,n){var r=[];e.split("/").forEach((function(e){e.split("").forEach((function(e){if(Number.isInteger(parseInt(e))){var t=new Array(parseInt(e)).fill(s.EMPTY);r.push.apply(r,Object(E.a)(t))}else r.push(D[e])}))})),49!==r.length&&n("Board: Incorrect notation"),t(r)}))},q=function(e){return new Promise((function(t,n){4!==e.length&&n("Capture: Incorrect notation"),t(Object.fromEntries(R(e.split(""),2).map((function(e){return[D[e[0]],parseInt(e[1])]}))))}))},Q={board:[],boardHistory:[],pieces:[],turn:1,moveTable:null,winner:null,currentPlayer:null,captures:(P={},Object(y.a)(P,s.BLACK,0),Object(y.a)(P,s.WHITE,0),P),hashTable:Array(49).fill(0).map((function(){var e=new Uint32Array(3);return window.crypto.getRandomValues(e),e})),hash:0,allowExtraTurns:!0,errorMessage:{message:"",update:0}},X=Object(T.a)((function(e,t){return Object(x.a)(Object(x.a)({},Q),{},{makeMove:function(n){var r=Object(h.a)(n,2),a=r[0],c=r[1],o=t(),u=o.getMarble,i=o.currentPlayer,l=o.tryMove,b=o.boardHistory,O=o.encode,j=o.searchMoves,f=o.preCheckMove,d=o.allowExtraTurns,p=u(a);f([a,c]).then(l).then((function(n){var r,a;e({hash:n});var c=L(p),o=U(t().board),u=U(null!==(r=null===(a=w(b))||void 0===a?void 0:a.board)&&void 0!==r?r:F()),l=u[c]-o[c],f=u[s.RED]-o[s.RED],h=!d||(null===i||0===l&&0===f),v=h?c:i,g=j(),m=B(g,c),E=0===u[c]||t().captures[p]>=7||0===m;e((function(e){var t=e.captures[p]+f;return{currentPlayer:v,moveTable:E?null:g,winner:E?p:null,turn:h?e.turn+1:e.turn,captures:Object(x.a)(Object(x.a)({},e.captures),{},Object(y.a)({},p,t))}})),N(O())})).catch(t().setError)},undo:function(){var n=t(),r=n.turn,a=n.boardHistory,c=n.encode;if(!(r<=1)){var o=a.pop(),u=o.board,i=o.player,s=o.pieces,l=o.captures,b=o.hash;e((function(e){return{currentPlayer:i,captures:l,pieces:s,board:u,hash:b,winner:null,moveTable:e.searchMoves(),turn:i!==e.currentPlayer?e.turn-1:e.turn}})),N(c())}},propagateMove:function(n){return function(r){var a=t(),c=a.getMarble,o=a.setMarble;r.forEach((function(r){var a=_([r,n]),u=c(r),i=M(r,S[n]),s=t().pieces.map((function(e){return e.pos===r?Object(x.a)(Object(x.a)({},e),{},{pos:a?O.OFF_GRID:i}):e}));e({pieces:s}),a||o(i,u)})),o(w(r),s.EMPTY)}},simulateMove:function(e){return function(n){var r=t(),a=r.hashTable,c=r.getMarble,o=r.hash;return n.reduce((function(t,n,r){var o=c(n),u=H([n,e]);return 0===r&&_([n,e])?t^a[n][o]:t^a[n][o]^a[u][o]}),o)}},getSeries:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=t(),c=a.getMarble,o=a.getSeries,u=c(e);return u===s.EMPTY?r:_([e,n])?[e].concat(Object(E.a)(r)):o(H([e,n]),n,[e].concat(Object(E.a)(r)))},tryMove:function(e){var n=Object(h.a)(e,2),r=n[0],a=n[1];return new Promise((function(e,n){var c,o,u=t(),i=u.getSeries,s=u.propagateMove,l=u.getMarble,O=u.moveTable,j=u.checkMove,f=u.simulateMove,d=u.currentPlayer,p=u.pushHistory,h=i(r,a),v=null===d||null===O?j([r,a],h,l(r)):null!==(c=null===(o=O[r])||void 0===o?void 0:o.moves[a])&&void 0!==c?c:b.WRONG_TURN;v===b.NONE?(p(),s(a)(h),e(f(a)(h))):n(I[v])}))},getMarble:function(e){var n=t().board;try{var r;return null!==(r=n[e])&&void 0!==r?r:s.EMPTY}catch(a){return s.EMPTY}},setMarble:function(n,r){var a=t().board;try{if(void 0!==a[n]){var c=Object(E.a)(a);c[n]=r,e({board:c})}}catch(o){return}},modifyCapture:function(n,r){var a=t().captures,c=a[n]+r;e({captures:Object(x.a)(Object(x.a)({},a),{},Object(y.a)({},n,c))})},modifyTurn:function(t){e((function(e){return{turn:e.turn+t}}))},searchMoves:function(){var e=t(),n=e.pieces,r=e.checkMove,a=e.getSeries,c=Object.values(l);return n.filter((function(e){return e.color!==s.RED&&e.pos!==O.OFF_GRID})).reduce((function(e,t){var n=t.pos,o=t.color,u=c.reduce((function(e,t){var c=a(n,t),o=[n,t];return Object(x.a)(Object(x.a)({},e),{},Object(y.a)({},t,r(o,c)))}),{});return Object(x.a)(Object(x.a)({},e),{},Object(y.a)({},n,{color:o,moves:u}))}),{})},preCheckMove:function(e){var n=t(),r=n.getMarble,a=n.currentPlayer;return null===n.winner?null===a||r(e[0])===a?Promise.resolve(e):Promise.reject(I[b.WRONG_TURN]):Promise.reject(I[b.GAME_OVER])},checkMove:function(e,n){var r=Object(h.a)(e,2),a=r[0],c=r[1],o=t(),u=o.getMarble,i=o.simulateMove,s=o.boardHistory,l=G[c],O=function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return M(-S[r],n)}([a,c]),j=n[0],f=w(n);return z(u(O))||_([a,l])?_([j,c])&&u(j)===u(f)?b.OWN_MARBLE:s.length>1&&i(c)(n)===w(s).hash?b.NO_UNDO:b.NONE:b.WRONG_DIRECTION},pushHistory:function(){var e=t(),n=e.boardHistory,r=e.board,a=e.pieces,c=e.currentPlayer,o=e.captures,u=e.hash;n.push({board:r,pieces:a,player:c,captures:o,hash:u})},init:function(){var n,r=window.location.hash.slice(1),a=t().hashTable;(n=r,new Promise((function(e,t){var r=atob(n);r||t("Empty string");var a=r.split(" "),c=Object(h.a)(a,4),o=c[0],u=c[1],i=c[2],s=c[3],l="-"===s?null:D[s],b=parseInt(i);Promise.all([J(o),q(u)]).then((function(t){var n=Object(h.a)(t,2),r=n[0],a=n[1];e({board:r,captures:a,turn:b,currentPlayer:l})})).catch(t)}))).then((function(n){var r=n.board,a=n.currentPlayer,c=n.turn,o=n.captures;if(e({board:r,pieces:Y(r),turn:c,currentPlayer:a,captures:o}),null!==a){var u=t().searchMoves();e({moveTable:u}),0===B(u,a)&&e({winner:L(a)})}})).catch((function(){var t=F();e(Object(x.a)(Object(x.a)({},Q),{},{board:t,pieces:Y(t)}))})).finally((function(){var n=function(e,t){return e.reduce((function(e,n,r){return n!==s.EMPTY?e^t[r][n]:e}),0)}(t().board,a);e({hash:n,errorMessage:{message:"",update:0}})}))},setError:function(t){e({errorMessage:{message:t.toString(),update:Math.random()}})},toggleExtraTurn:function(){e((function(e){return{allowExtraTurns:!e.allowExtraTurns}}))},endTurn:function(){var n=t().currentPlayer;null!==n&&e({currentPlayer:L(n)})},reset:function(){N(),t().init()},encode:function(){var e=t();return function(e){var t=e.board,n=e.captures,r=e.currentPlayer,a=e.turn,c=K(t),o=V(n),u=null!==r?k[r]:"-",i=[c,o,a.toString(),u].join(" ");return btoa(i)}({board:e.board,captures:e.captures,turn:e.turn,currentPlayer:e.currentPlayer})}})})),Z=n(95),$=n(65),ee=n(52),te=n(6),ne=Object(v.a)((function(){return Object(g.a)({root:{background:function(e){switch(e.color){case"red":return"linear-gradient(135deg, #FE5B55 30%, #CC1E23 90%)";case"black":return"linear-gradient(135deg, black 30%, #666 90%)";case"white":return"linear-gradient(135deg, white 30%, #ddd 90%)";default:return"none"}},border:0,borderRadius:"50%",aspectRatio:"1",position:"absolute",cursor:function(e){return"empty"===e.color||"red"===e.color?"default":"pointer"},boxShadow:function(e){switch(e.color){case"red":return"0 3px 5px 2px rgba(255, 105, 135, .3)";case"black":return"0 3px 5px 2px rgba(25, 0, 10, .3)";case"white":return"0 3px 5px 2px rgba(0, 0, 0, .3)";default:return"none"}},userSelect:"none",touchAction:"none","&focus":{outline:"none !important"}}})})),re=function(e){return e.makeMove},ae=Object(ee.animated)(Z.a),ce=Object(j.memo)((function(e){var t=e.color,n=e.pos,r=e.size,a=e.x,c=e.y,o=ne(e),u=X(re),i=Object(j.useCallback)((function(e){u([n,e])}),[n,u]),s=Object(ee.useSpring)((function(){return{from:{x:a,y:c},config:{mass:1,tension:225,friction:30}}})),b=Object(h.a)(s,2),O=b[0],f=O.x,d=O.y,p=b[1];Object(j.useEffect)((function(){p({x:a,y:c})}),[a,c,p]);var v=Object($.a)((function(e){var n=e.down,r=Object(h.a)(e.movement,2),o=r[0],u=r[1],s=e.distance;if("black"===t||"white"===t){var b=s>30;p({x:n?a+o:a,y:n?c+u:c}),!n&&b&&i(function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return 0===n?r>0?l.DOWN:l.UP:n>0?l.RIGHT:l.LEFT}([o,u]))}}),{lockDirection:!0});return Object(te.jsx)(ae,Object(x.a)(Object(x.a)({className:o.root},v()),{},{style:{x:f,y:d,width:r}}))})),oe=Object(T.a)((function(e,t){return{gridSize:0,setGridSize:function(t){return e({gridSize:t})},calcPos:function(e){var n=t().gridSize,r=n*(1-.8)/2;return{x:n*(e%7)+r,y:n*Math.floor(e/7)+r}}}})),ue=new Array(7).fill(0).map((function(){return new Array(7).fill(0)})),ie=Object(v.a)((function(e){return Object(g.a)({grid:{userSelect:"none"},paper:{padding:e.spacing(1),color:e.palette.text.secondary,aspectRatio:"1"}})})),se=function(e){return e.setGridSize},le=function(){var e=ie(),t=oe(se),n=Object(j.useRef)();return Object(j.useEffect)((function(){var e=function(){if(n.current){var e,r=(null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect()).width;t(r/7)}};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[n,t]),Object(te.jsx)(m.a,{ref:n,className:e.grid,container:!0,children:ue.map((function(t,n){return Object(te.jsx)(m.a,{container:!0,item:!0,spacing:0,children:t.map((function(t,n){return Object(te.jsx)(m.a,{item:!0,xs:!0,children:Object(te.jsx)(Z.a,{className:e.paper,variant:"outlined",square:!0})},n)}))},n)}))})},be=Object(v.a)((function(e){return Object(g.a)({grid:{userSelect:"none",touchAction:"none"},paper:{padding:e.spacing(1),color:e.palette.text.secondary}})})),Oe=function(e){return e.pieces},je=function(){var e=be(),t=X(Oe),n=oe(Object(j.useCallback)((function(e){return[e.gridSize,e.calcPos]}),[])),r=Object(h.a)(n,2),a=r[0],c=r[1];return Object(te.jsxs)(m.a,{className:e.grid,container:!0,children:[Object(te.jsx)(le,{}),t.map((function(e){if(e.pos===O.OFF_GRID)return null;var t=c(e.pos),n=t.x,r=t.y;return Object(te.jsx)(ce,{color:s[e.color].toLowerCase(),size:.8*a,pos:e.pos,x:n,y:r},e.id)}))]})},fe=n(96),de=n(124),pe=n(125),he=n(128),ve=n(126),ge=n(133),me=n(130),Ee=n(121),xe=n(123),ye=n(129),Te=Object(j.memo)((function(e){var t=X(Object(j.useCallback)((function(e){return[e.undo,e.boardHistory]}),[])),n=Object(h.a)(t,2),r=n[0],a=n[1];return Object(te.jsx)(Ee.a,{variant:"contained",disabled:0===a.length,onClick:r,children:e.children})})),we=Object(j.memo)((function(e){var t=X(Object(j.useCallback)((function(e){return e.reset}),[]));return Object(te.jsx)(Ee.a,{variant:"contained",color:"secondary",onClick:t,children:e.children})})),Me=Object(j.memo)((function(e){var t=Object(j.useState)(!1),n=Object(h.a)(t,2),r=n[0],a=n[1],c=Object(j.useCallback)((function(){navigator.clipboard.writeText(window.location.href).then((function(){a(!0)}))}),[]),o=Object(j.useCallback)((function(){a(!1)}),[]);return Object(te.jsxs)(te.Fragment,{children:[Object(te.jsx)(Ee.a,{variant:"contained",onClick:c,children:e.children}),Object(te.jsx)(he.a,{open:r,autoHideDuration:2e3,onClose:o,anchorOrigin:{vertical:"top",horizontal:"right"},children:Object(te.jsx)(me.a,{onClose:o,severity:"success",children:"Copied to clipboard"})})]})})),Ne=Object(j.memo)((function(e){var t=X(Object(j.useCallback)((function(e){return[e.allowExtraTurns,e.toggleExtraTurn]}),[])),n=Object(h.a)(t,2),r=n[0],a=n[1];return Object(te.jsx)(xe.a,{control:Object(te.jsx)(ye.a,{checked:r,onChange:a}),label:e.label})})),Re=n(132),Ce=Object(v.a)({root:{outline:"none",boxShadow:"none"},title:{fontSize:"3em"},backdrop:{zIndex:999,color:"white"}}),Pe=function(){var e=Ce(),t=Object(j.useState)(!1),n=Object(h.a)(t,2),r=n[0],a=n[1],c=Object(j.useState)(!1),o=Object(h.a)(c,2),u=o[0],i=o[1],l=Object(Re.a)().t,b=X(Object(j.useCallback)((function(e){return[e.turn,e.currentPlayer,e.errorMessage,e.captures,e.winner]}),[])),O=Object(h.a)(b,5),f=O[0],d=O[1],p=O[2],v=O[3],g=O[4];Object(j.useEffect)((function(){p.message?a(!0):a(!1),null!==g&&i(!0)}),[p,g]);var m=Object(j.useCallback)((function(e,t){"clickaway"!==t&&a(!1)}),[]),E=Object(j.useCallback)((function(){i(!1)}),[]);return Object(te.jsxs)(te.Fragment,{children:[Object(te.jsxs)(de.a,{className:e.root,variant:"elevation",children:[Object(te.jsxs)(pe.a,{children:[Object(te.jsx)(fe.a,{className:e.title,variant:"h1",component:"h1",gutterBottom:!0,children:l("title")}),Object(te.jsxs)(fe.a,{children:["Turn ",f,","," ",null!==d?C(s[d]):l("anyone")]}),Object(te.jsxs)(fe.a,{children:["Captures: ",l("white"),": ",v[s.WHITE],", ",l("black"),":"," ",v[s.BLACK]]}),Object(te.jsx)(he.a,{open:r,autoHideDuration:2e3,onClose:m,anchorOrigin:{vertical:"top",horizontal:"center"},children:Object(te.jsx)(me.a,{onClose:m,severity:"warning",children:p.message})})]}),Object(te.jsxs)(ve.a,{children:[Object(te.jsx)(Te,{children:l("undo")}),Object(te.jsx)(we,{children:l("reset")}),Object(te.jsx)(Me,{children:l("export")}),Object(te.jsx)(Ne,{label:l("allowExtra")})]})]}),Object(te.jsx)(ge.a,{className:e.backdrop,open:u,onClick:E,children:Object(te.jsxs)(fe.a,{variant:"h1",component:"h1",children:[s[g]," wins"]})})]})},Ie=n(127),ke=n(54),De=n(41);ke.a.use(De.e).init({resources:{en:{translation:{title:"Kuba",black:"Black",white:"White",anyone:"Anyone",undo:"Undo",reset:"Reset",export:"Export game state",allowExtra:"Allow extra turn"}}},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}}).then();ke.a;var Se=function(){var e=X((function(e){return e.init}));return Object(j.useEffect)((function(){e()}),[e]),Object(te.jsxs)(Ie.a,{maxWidth:"sm",children:[Object(te.jsx)(Pe,{}),Object(te.jsx)(je,{})]})},We=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,135)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};p.a.render(Object(te.jsx)(f.a.StrictMode,{children:Object(te.jsx)(Se,{})}),document.getElementById("root")),We()}},[[94,1,2]]]);